import { useEffect, useState } from 'react';
import axios from 'axios';

function useChartData(selectedRegion, selectedProvince) {
  const [chartData, setChartData] = useState({});
  
  useEffect(() => {
    axios
      .get('https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-json/dpc-covid19-ita-province-latest.json')
      .then((response) => {
        const provinceData = response.data;

        if (provinceData && provinceData.length > 0) {
          if (selectedRegion === '') {
            // Nessuna regione selezionata, mostra il grafico vuoto
            setChartData({});
            return;
          }

          // Filtra i dati per la regione selezionata
          const filteredData = provinceData.filter(
            (item) => item.denominazione_regione === selectedRegion
          );

          const provinceNames = filteredData.map((item) => item.denominazione_provincia);

          if (selectedProvince === '') {
            // Nessuna provincia selezionata, mostra tutti i dati della regione
            const totalCases = filteredData.map((item) => item.totale_casi);

            const chartData = {
              labels: provinceNames,
              datasets: [
                {
                  label: 'Totale Casi',
                  data: totalCases,
                  backgroundColor: 'orange', // Colore grafico barre
                },
              ],
            };

            setChartData(chartData);
          } else {
            // Filtra i dati anche per la provincia selezionata
            const provinceDataFiltered = filteredData.filter(
              (item) => item.denominazione_provincia === selectedProvince
            );

            const chartData = {
              labels: [selectedProvince],
              datasets: [
                {
                  label: 'Totale Casi',
                  data: provinceDataFiltered.map((item) => item.totale_casi),
                  backgroundColor: "orange", // Colore grafico barre
                },
              ],
            };
            setChartData(chartData);
          }
        }
      })
      .catch((error) => {
        // Gestisci gli errori
        console.error('Errore nella richiesta API:', error);
      })
      .finally(() => {
        // Eventuali azioni da eseguire alla fine della chiamata API
      });
  }, [selectedRegion, selectedProvince]);

  return chartData;
}

export default useChartData;
